import{d as P,o as l,c as n,t as c,h as i,a as D,w as _,b,j as M,F as k,i as w,n as $,g as h,Q as U,r as C,e as O,f as N,x as F,D as R,y as S,z as I}from"./app-632bf8b8.js";import{_ as B,b as z}from"./AppButton-ffc821ac.js";import{u as G}from"./useAxios-d55f63a8.js";import{d as H}from"./dayjs.min-356b711c.js";import{_ as L}from"./LabelText-36465a88.js";const J={class:"p-2 mb-4 min-h-screen flex flex-col items-center justify-center"},K={key:0,class:"text-center"},W={key:1,class:"text-center"},X={key:2,class:"text-center"},Z={key:3,class:"text-center"},ee={key:4,class:"text-center"},te=["src"],le={key:5,class:"text-center"},ie=["src"],se={class:"mt-2 mb-6"},re=["href"],de={key:6,class:"text-center font-bold pt-3"},ne={key:7,class:"flex gap-4 mt-6"},ae={class:"border-2 divide-y-2 rounded-lg"},oe={class:"text-lg"},ce={key:0},ue={class:"flex gap-4 mt-6"},j={__name:"DeliveryBlock",props:{deliveryData:{type:Object,required:!0},deliveryPhone:{type:[Number,String],required:!0}},emits:["status-updated"],setup(s,{emit:y}){const E=s,p=y,f=P(),g=G(),m=(u,v)=>{g.post(route("courier.deliveries.set-status"),{delivery_id:u.id,picked_up_status:v}).then(()=>{u.picked_up_status=v,f.success("Статус изменен"),p("status-updated",{phone:E.deliveryPhone,deliveryId:u.id,status:v})}).catch(()=>{f.error("Не удалось установить статус, попробуйте еще раз")})},o=u=>{u.version=H().format("YYYYMDhms")};return(u,v)=>(l(),n("div",J,[s.deliveryData[0].deliveryable.delivery_phone!=null?(l(),n("div",K," TEL "+c(s.deliveryData[0].deliveryable.delivery_phone),1)):(l(),n("div",W,"TEL "+c(s.deliveryData[0].deliveryable.phone),1)),s.deliveryData[0].deliveryable.delivery_pin!=null?(l(),n("div",X," CODE "+c(s.deliveryData[0].deliveryable.delivery_pin),1)):(l(),n("div",Z,"CODE "+c(s.deliveryData[0].deliveryable.code),1)),s.deliveryData[0].deliveryable.delivery_qrcode!=null?(l(),n("div",ee,[i("img",{src:"/storage/"+s.deliveryData[0].deliveryable.delivery_qrcode+"?v=e"+s.deliveryData[0].version,width:"240",height:"240",class:"inline-block"},null,8,te)])):s.deliveryData[0].deliveryable.qr_code_link!=null?(l(),n("div",le,[i("img",{src:s.deliveryData[0].deliveryable.qr_code_link,width:"240",height:"240",class:"inline-block"},null,8,ie),i("div",se,[i("a",{href:s.deliveryData[0].deliveryable.qr_code_link,target:"_blank"}," Открыть в новой вкладке ",8,re)])])):(l(),n("div",de,"QR Отсутствует")),s.deliveryData[0].deliveryable.delivery_qrcode!=null?(l(),n("div",ne,[D(B,{onClick:v[0]||(v[0]=a=>o(s.deliveryData[0]))},{default:_(()=>[b("Перезагрузить QR")]),_:1})])):M("",!0),i("div",ae,[(l(!0),n(k,null,w(s.deliveryData,a=>{var x,q;return l(),n("div",{key:a.id,class:"p-2 flex flex-col items-center justify-center"},[i("div",{class:$(["ml-auto text-white rounded-xl px-2 text-xs",{"bg-blue-500":a.type=="mpbtop","bg-orange-300":a.type=="outside"}])},c(a.type),3),i("div",oe,c((q=(x=a.deliveryable)==null?void 0:x.product)==null?void 0:q.name),1),a.deliveryable.to_decline?(l(),n("div",ce,[D(L,{theme:"warning"},{default:_(()=>[b(" От этого товара нужно отказаться! ")]),_:1})])):M("",!0),i("div",ue,[a.picked_up_status==0?(l(),n(k,{key:0},[a.deliveryable.to_decline?(l(),h(B,{key:1,onClick:A=>m(a,1)},{default:_(()=>[b(" Отказался ")]),_:2},1032,["onClick"])):(l(),h(B,{key:0,onClick:A=>m(a,1)},{default:_(()=>[b(" Забрал ")]),_:2},1032,["onClick"])),D(B,{onClick:A=>m(a,-1),theme:"oldanger"},{default:_(()=>[b(" Отсутствует ")]),_:2},1032,["onClick"])],64)):a.picked_up_status==1?(l(),h(L,{key:1,theme:"success"},{default:_(()=>[b(" Забран ")]),_:1})):(l(),h(L,{key:2,theme:"danger"},{default:_(()=>[b("Отсутствует")]),_:1}))])])}),128))])]))}},ve={class:"w-full mx-auto"},ye={class:"text-4xl font-bold text-center py-8"},pe={class:""},he={class:"text-xl p-2 bg-teal-900 rounded-lg text-white"},me={class:"px-2 my-2"},fe={class:"px-2 my-2"},xe={class:"px-2 my-2"},_e={class:"px-2 my-2"},Ce={__name:"Deliveries",props:{zone:{type:Object,required:!0},address:{type:Object,required:!0},deliveries:{type:Object,required:!0},completedDeliveries:{type:Object,required:!0},completedExternalDeliveries:{type:Object,required:!0},missedExternalDeliveries:{type:Object,required:!0},completedDeliveriesNotApproved:{type:Object,required:!0},totalDeliveries:{type:Number,required:!0}},setup(s){const y=s,E=U(),p=C(y.deliveries),f=C(y.completedDeliveries),g=C(y.completedExternalDeliveries),m=C(y.missedExternalDeliveries),o=C(y.completedDeliveriesNotApproved??{}),u=O(!1),v=O(!1),a=O(!1),x=O(!1),q=N(()=>Object.values(y.completedDeliveries).reduce((e,t)=>e+t.length,0)),A=N(()=>Object.values(y.completedExternalDeliveries).reduce((e,t)=>e+t.length,0)),Q=N(()=>Object.values(y.missedExternalDeliveries).reduce((e,t)=>e+t.length,0)),T=N(()=>Object.values(o).reduce((e,t)=>e+t.length,0)),V=e=>{if(p[e.phone]){const t=p[e.phone].find(r=>r.id==e.deliveryId);if(t.type=="mpbtop"?(Array.isArray(o[e.phone])||(o[e.phone]=[]),o[e.phone].push(t)):e.status==1?(Array.isArray(g[e.phone])||(g[e.phone]=[]),g[e.phone].push(t)):e.status==-1&&(Array.isArray(m[e.phone])||(m[e.phone]=[]),m[e.phone].push(t)),p[e.phone].length==1)delete p[e.phone];else{const r=p[e.phone].findIndex(d=>d.id==e.deliveryId);p[e.phone].splice(r,1)}}};return F(()=>{window.Echo.private("user."+E.props.auth.user.id).listen(".courier.delivery.update",e=>{if(e.deliveryable.delivery_status!="picked_up")return;const t=e.deliveryable.delivery_phone;if(!o[t])return;const r=o[t].find(d=>d.id==e.id);if(r)if(Array.isArray(f[t])||(f[t]=[]),f[t].push(r),o[t].length==1)delete o[t];else{const d=o[t].findIndex(Y=>Y.id==e.id);o[t].splice(d,1)}})}),R(()=>{window.Echo.private("user."+E.props.auth.user.id).stopListening(".courier.delivery.update")}),(e,t)=>(l(),n("div",ve,[i("h1",ye,c(s.zone.name),1),i("div",pe,[i("div",he,c(s.address.address)+" ("+c(s.totalDeliveries)+" шт.) ",1),i("div",me,[i("div",{class:"text-white bg-green-600 rounded px-2 py-2 flex justify-between",onClick:t[0]||(t[0]=r=>u.value=!u.value)},[i("span",null,"Забранные ("+c(q.value)+"шт.)",1),D(z,{icon:"chevron-down",class:$(["stroke-white",{"rotate-180":u.value}])},null,8,["class"])]),S(i("div",null,[(l(!0),n(k,null,w(f,(r,d)=>(l(),h(j,{key:d,"delivery-data":r,"delivery-phone":d},null,8,["delivery-data","delivery-phone"]))),128))],512),[[I,u.value]])]),i("div",fe,[i("div",{class:"text-white bg-green-600 rounded px-2 py-2 flex justify-between",onClick:t[1]||(t[1]=r=>v.value=!v.value)},[i("span",null,"Забранные загруженные ("+c(A.value)+"шт.)",1),D(z,{icon:"chevron-down",class:$(["stroke-white",{"rotate-180":v.value}])},null,8,["class"])]),S(i("div",null,[(l(!0),n(k,null,w(g,(r,d)=>(l(),h(j,{key:d,"delivery-data":r,"delivery-phone":d},null,8,["delivery-data","delivery-phone"]))),128))],512),[[I,v.value]])]),i("div",xe,[i("div",{class:"text-white bg-red-600 rounded px-2 py-2 flex justify-between",onClick:t[2]||(t[2]=r=>a.value=!a.value)},[i("span",null,"Не забранные загруженные ("+c(Q.value)+"шт.)",1),D(z,{icon:"chevron-down",class:$(["stroke-white",{"rotate-180":a.value}])},null,8,["class"])]),S(i("div",null,[(l(!0),n(k,null,w(m,(r,d)=>(l(),h(j,{key:d,"delivery-data":r,"delivery-phone":d},null,8,["delivery-data","delivery-phone"]))),128))],512),[[I,a.value]])]),i("div",_e,[i("div",{class:"text-white bg-orange-600 rounded px-2 py-2 flex justify-between",onClick:t[3]||(t[3]=r=>x.value=!x.value)},[i("span",null," Забранные не подтвержденные ("+c(T.value)+"шт.) ",1),D(z,{icon:"chevron-down",class:$(["stroke-white",{"rotate-180":x.value}])},null,8,["class"])]),S(i("div",null,[(l(!0),n(k,null,w(o,(r,d)=>(l(),h(j,{key:d,"delivery-data":r,"delivery-phone":d},null,8,["delivery-data","delivery-phone"]))),128))],512),[[I,x.value]])]),(l(!0),n(k,null,w(p,(r,d)=>(l(),h(j,{key:d,"delivery-data":r,"delivery-phone":d,onStatusUpdated:V},null,8,["delivery-data","delivery-phone"]))),128))])]))}};export{Ce as default};
