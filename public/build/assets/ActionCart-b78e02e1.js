import{d as H,r as O,e as C,f as W,o as c,g as z,w as s,b as l,h as e,a as t,t as i,u as m,c as _,F as w,i as U,O as B,Q as L,Z as Q,n as V}from"./app-632bf8b8.js";import{d as Z}from"./dayjs.min-356b711c.js";import{a as $}from"./Modal-1349d4bc.js";import{c as T,W as G,a as j,f as J,b as K,_ as R}from"./AuthenticatedLayout-6b95fe5a.js";import{_ as v}from"./AppButton-ffc821ac.js";import{E as X}from"./EmptyState-d0b40849.js";import{u as ee}from"./useAxios-d55f63a8.js";import{A as E,T as h}from"./TableTh-6fdd4a53.js";import{_ as te}from"./SelectInput-944e57c4.js";import{_ as N}from"./TextInput-7865c9b5.js";import{_ as k}from"./LabelText-36465a88.js";import{_ as se}from"./ProgressBar-77013aff.js";import"./index-4cd942bc.js";import"./index-81635579.js";import"./CheckboxInput-967d96fa.js";const le={class:"flex items-center"},ae=e("div",null,"Укажите товар и запросы по которым товар будет добавлен в корзину.",-1),oe={class:"ml-auto flex gap-3"},re={class:"flex items-center gap-1 w-80"},de={class:"product__image"},ne=["src"],ce={class:"product__info"},ie={class:"product__info-title"},ue={class:"product__info-price"},_e={class:"flex justify-center"},me={class:"flex justify-center"},pe={class:"flex items-center gap-1"},fe=e("div",{class:"w-10"},null,-1),P=5,he={__name:"ActionCartModal",setup(x){const b=H(),p=ee(),{loading:g}=p,d=O([]),n=C(""),a=()=>{let r=!0;return d.forEach(u=>{u.keywords?u.errors.keywords=null:(u.errors.keywords="Укажите запрос",r=!1)}),r},y=C(!1),I=()=>{p.post(route("search.do"),{product_code:n.value}).then(r=>{y.value=!0,d.push({product_code:"",view_time:1,period:{key:3,name:"3 часа"},quantity:1,keywords:"",product_code:r.data.product.remote_id,product:r.data.product,errors:{}})}).catch(r=>{})},Y=function(){a()&&p.post(route("actions.add-to-cart.store"),{actions:d,product_code:n.value}).then(()=>{B.reload(),d.splice(0,d.length),y.value=!1,$.close(),b.success("Задача успешно добавлена!")}).catch(r=>{b.error(r.response.data.message)})},D=r=>{d.splice(r,1)},F=r=>{d.push({...d[r]})},M=W(()=>d.reduce((r,u)=>r+u.quantity*P,0));return(r,u)=>(c(),z(K,{"header-class":"modal__header_noborder modal__header_pbsm","body-class":"modal__body_nopadding-top","wrapper-class":"modal__wrapper_slide-review",show:m($).show,onClose:u[1]||(u[1]=o=>m($).close())},{header:s(()=>[l(" Добавление в корзину ")]),caption:s(()=>[e("div",le,[ae,e("div",oe,[t(k,{theme:"info"},{default:s(()=>[l("Цена: "+i(P)+"₽/штука")]),_:1}),t(k,null,{default:s(()=>[l("Всего: "+i(d.length),1)]),_:1}),t(k,null,{default:s(()=>[l("К оплате: "+i(m(T).format(M.value)),1)]),_:1})])])]),search:s(()=>[t(N,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=o=>n.value=o),placeholder:"Введите артикул","wrapper-class":"grow",size:"lg",ref:"searchInput",disabled:y.value},null,8,["modelValue","disabled"]),t(v,{size:"lg",disabled:n.value=="",onClick:I},{default:s(()=>[l(" Добавить ")]),_:1},8,["disabled"])]),actions:s(()=>[t(v,{size:"lg",disabled:m(g),onClick:Y},{default:s(()=>[l("Отправить")]),_:1},8,["disabled"])]),default:s(()=>[t(E,null,{head:s(()=>[e("tr",null,[t(h,{class:"text-left"},{default:s(()=>[l("Товар")]),_:1}),t(h,{class:"text-left"},{default:s(()=>[l("Ключевой запрос")]),_:1}),t(h,{class:"text-center"},{default:s(()=>[l("Время просмотра")]),_:1}),t(h,{class:"text-center"},{default:s(()=>[l("Количество")]),_:1}),t(h,{class:"text-left"},{default:s(()=>[l("Период")]),_:1})])]),default:s(()=>[(c(!0),_(w,null,U(d,(o,A)=>{var q,S;return c(),_("tr",{key:o.id,class:"main-table__tr"},[e("td",null,[e("div",re,[e("div",de,[e("img",{src:m(G).constructHostV2(o.product.remote_id)+"/images/tm/1.webp",alt:"",width:"30",height:"40"},null,8,ne)]),e("div",ce,[e("div",ie,i(o.product.name),1),e("div",ue,i(m(T).format(o.product.price)),1)])])]),e("td",null,[t(N,{modelValue:o.keywords,"onUpdate:modelValue":f=>o.keywords=f,size:"sm","has-error":((q=o.errors)==null?void 0:q.keywords)!=null,"error-message":(S=o.errors)==null?void 0:S.keywords},null,8,["modelValue","onUpdate:modelValue","has-error","error-message"])]),e("td",null,[e("div",_e,[t(j,{modelValue:o.view_time,"onUpdate:modelValue":f=>o.view_time=f},null,8,["modelValue","onUpdate:modelValue"])])]),e("td",null,[e("div",me,[t(j,{modelValue:o.quantity,"onUpdate:modelValue":f=>o.quantity=f,min:1},null,8,["modelValue","onUpdate:modelValue"])])]),e("td",null,[e("div",pe,[t(te,{modelValue:o.period,"onUpdate:modelValue":f=>o.period=f,items:m(J),size:"md"},null,8,["modelValue","onUpdate:modelValue","items"]),fe,t(v,{theme:"normal",size:"sm",icon:"copy",onClick:f=>F(A)},null,8,["onClick"]),t(v,{theme:"normal",size:"sm",icon:"delete",onClick:f=>D(A)},null,8,["onClick"])])])])}),128))]),_:1})]),_:1},8,["show"]))}},ve=e("title",null,"Добавление в корзину",-1),ye={class:"panel mb-6"},ge={class:"flex gap-1.5"},ke={class:"ml-auto flex gap-3"},xe={key:0,class:"panel panel_product"},we={class:"text-xs text-gray-400"},$e={key:0},be={class:"flex gap-1 flex-wrap leading-none text-gray-300"},Ve={class:"pr-6"},Ce={class:"w-[234px]"},ze={class:"pl-6 flex justify-end"},Ue={key:1,class:"panel flex flex-col grow"},Ae=e("div",{class:"header-5 mb-1.5"},"Задач пока нет",-1),Le={__name:"ActionCart",props:{actions:{type:Array,required:!0},section:{type:String,required:!0}},setup(x){const p=C(x.section);L();const g=d=>{p.value=d,B.reload({only:["actions"],data:{section:p.value}})};return(d,n)=>(c(),_(w,null,[t(m(Q),null,{default:s(()=>[ve]),_:1}),t(R,null,{header:s(()=>[l("Добавление в корзину")]),default:s(()=>[e("div",ye,[e("div",ge,[t(v,{theme:"normal",class:V({btn_selected:p.value=="process"}),onClick:n[0]||(n[0]=a=>g("process"))},{default:s(()=>[l(" В процессе ")]),_:1},8,["class"]),t(v,{theme:"normal",class:V({btn_selected:p.value=="done"}),onClick:n[1]||(n[1]=a=>g("done"))},{default:s(()=>[l(" Выполненные ")]),_:1},8,["class"]),t(v,{theme:"normal",class:V({btn_selected:p.value=="all"}),onClick:n[2]||(n[2]=a=>g("all"))},{default:s(()=>[l(" Все ")]),_:1},8,["class"]),e("div",ke,[t(v,{size:"md",onClick:n[3]||(n[3]=a=>m($).open())},{default:s(()=>[l(" Добавить ")]),_:1})])])]),x.actions.length?(c(),_("div",xe,[t(E,null,{head:s(()=>[e("tr",null,[t(h,{class:"text-left"},{default:s(()=>[l("Товар")]),_:1}),t(h,{class:"text-left"},{default:s(()=>[l("Артикул")]),_:1}),t(h,{class:"text-left"},{default:s(()=>[l("Прогресс")]),_:1}),t(h,{class:"text-left"})])]),default:s(()=>[(c(!0),_(w,null,U(x.actions,a=>(c(),_("tr",{key:a.id,class:"main-table__tr"},[e("td",null,[e("div",null,i(a.product.name),1),e("div",we," ID"+i(a.id)+" от "+i(m(Z)(a.created_at).format("D/M/YYYY h:m")),1),(c(),_("div",$e,[l(" Process: "),e("div",be,[(c(!0),_(w,null,U(a.action_carts,y=>(c(),_("span",{key:y.task_id},i(y.task_id)+", ",1))),128))])]))]),e("td",null,[e("div",Ve,i(a.product_id),1)]),e("td",null,[e("div",Ce,[e("div",null,i(a.progress)+" из "+i(a.total),1),t(se,{progress:a.progress/a.total*100},null,8,["progress"])])]),e("td",null,[e("div",ze,[a.status==1?(c(),z(k,{key:0,theme:"info"},{default:s(()=>[l("В процессе")]),_:1})):(c(),z(k,{key:1,theme:"success"},{default:s(()=>[l("Завершено")]),_:1}))])])]))),128))]),_:1})])):(c(),_("div",Ue,[t(X,{class:"grow"},{default:s(()=>[Ae]),_:1})]))]),_:1}),t(he)],64))}};export{Le as default};
